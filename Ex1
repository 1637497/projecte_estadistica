#EXERCICI 1
library(readxl)
#Carreguem les dades
pinguins0 <- read.csv("C:\\Users\\Usuario\\OneDrive\\Escriptori\\UAB\\3r\\Anàlisi Estadístic\\trabajo final\\penguins1.csv")

# Eliminem les files NA
pinguins0 <- na.omit(pinguins0)

# Seleccionar columnas específicas
cols <- pinguins0[c("species", "bill_length_mm", "bill_depth_mm", 
"flipper_length_mm","body_mass_g", "sex", "island")]

# Fijar la semilla para reproducibilidad
set.seed(102)

# Seleccionar 50 filas aleatorias
valors_seed <- sample(1:nrow(cols), 50, replace = FALSE)

# Crear un nuevo DataFrame con las 50 filas seleccionadas
pinguins <- cols[valors_seed, ]




especies <- pinguins$species
especies <- as.numeric(factor(especies, levels = unique(especies)))
bec_llargada <- pinguins$bill_length_mm
bec_profunditat <- pinguins$bill_depth_mm
aleta_llargada <- pinguins$flipper_length_mm
massa_corporal <- pinguins$body_mass_g
sexe <- pinguins$sex
illa <- pinguins$island


#Gràfica Sexes
barplot(
  table(pinguins$sex), 
  col = c("blue", "red"), 
  main = "Distribució de Sexes", 
  xlab = "Sexe", 
  ylab = "Frequència",
  beside = TRUE,
)

#Gràfica Espècies
barplot(
  table(pinguins$species), 
  col = c("green", "red",'blue'), 
  main = "Distribució d'Espècies", 
  xlab = "Espècie", 
  ylab = "Frequència",
  beside = TRUE,
)

#Gràfica Massa
barplot(table(pinguins$body_mass_g), col = "skyblue", main = "Distribució Masses corporals", xlab = "Massa corporal", ylab = "Frequència", las = 2)

#Gràfica Aleta
barplot(table(aleta_allargada), col = "skyblue", main = "Distribució Llargades de l'aleta", xlab = "LLargada", ylab = "Frequència", las = 2)

#Gràfica Bec
barplot(table(bec_llargada), col = "skyblue", main = "Distribució Llargades del bec", xlab = "LLargada", ylab = "Frequència", las = 2)


#aleta_llargada~sexe
boxplot(aleta_llargada~sexe,
        data=smokers,
        main="aleta_llargada~sexe",
        xlab="aleta_llargada",
        ylab="sexe",
        col="yellow",
        border="black"
)

#bec_llargada~sexe
boxplot(aleta_llargada~sexe,
        data=smokers,
        main="bec_llargada~sexe",
        xlab="bec_llargada",
        ylab="sexe",
        col="yellow",
        border="black"
)


#Gràfica Illes
barplot(table(illa), col = "green", main = "Distribució d'illes", xlab = "Illa", ylab = "Frequència", las = 2)

#Correlació massa aleta
plot(massa_corporal, aleta_llargada, pch = 25, col = "green", xlab = "massa_corporal", ylab = "aleta_llargada")
abline(lm(aleta_llargada ~ massa_corporal), col = "red", lwd = 5)
legend("topleft", paste("Correlació:", round(cor(massa_corporal, aleta_llargada), 2)))

#Correlació massa bec
plot(massa_corporal, bec_llargada, pch = 25, col = "green", xlab = "massa_corporal", ylab = "aleta_llargada")
abline(lm(bec_llargada ~ massa_corporal), col = "red", lwd = 5)
legend("topleft", paste("Correlació:", round(cor(massa_corporal, bec_llargada), 2)))


#Fem el model
model <- lm(massa_corporal~ especies + bec_llargada + aleta_llargada)
summary(model)

#u<-matrix(1, nrow = 10, ncol = 1)
u=rep(1, times = length(massa_corporal))
x1=c(especies)
x2=c(bec_llargada)
x3=c(aleta_llargada)
y=matrix(c(massa_corporal),ncol=1)

X=t(rbind(u,x1,x2,x3))
XTX=t(X)%*%X 


d=det(XTX)
d

iv=solve(XTX)
iv

beta=iv%*%t(X)%*%y
beta



SSE=t(y)%*%y-t(beta)%*%t(X)%*%y
SSE

SSR=t(beta)%*%t(X)%*%y -((sum(y))**2/N)
SSR

SST=SSE+SSR
SST



N=length(massa_corporal)
K=3
anova <- data.frame(
  Fv = c("REGRE", "ERROR", "TOTAL"),
  gL = c(K, N-K-1, N-1),
  SS = c(SSR, SSE, SST),
  MS = c(SSR/K,SSE/(N-K-1),NA),
  Fo = c((SSR/K)/(SSE/(N-K-1)),NA,NA)
)
anova

Fo <- anova$Fo[1]
Fo>qf(0.95,3,46)


MSE=SSE/(N-K-1)
# Función para calcular la validación individual de una variable en un modelo
val_ind <- function(model, X, MSE, variable_index) {
  # Obtén los parámetros estimados
  beta <- coef(model)
  
  # Calcula la matriz (X'X)^(-1)
  XtX_inv <- solve(crossprod(X))
  
  # Calcula la diagonal de la inversa de (X'X)
  XtX_inv_diag <- diag(XtX_inv)
  
  # Calcula el numerador de t0: beta_i
  numerator <- beta[variable_index + 1]
  
  # Calcula el denominador de t0
  denominator <- sqrt(MSE * XtX_inv_diag[variable_index + 1])
  
  # Calcula t0
  t0 <- numerator / denominator
  print((t0))
  return(abs(t0))
}


resultado1_t0 <- val_ind(model, X, MSE, 1)
resultado1_t0>qt(1-0.05/2,N-K-1)
resultado2_t0 <- val_ind(model, X, MSE, 2)
resultado2_t0>qt(1-0.05/2,N-K-1)
resultado3_t0 <- val_ind(model, X, MSE, 3)
resultado3_t0>qt(1-0.05/2,N-K-1)




